var L=Object.defineProperty;var G=(p,s,t)=>s in p?L(p,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[s]=t;var l=(p,s,t)=>(G(p,typeof s!="symbol"?s+"":s,t),t);import{O as I,y as W,k,z as P,d as T,B as H,H as A,S as q,C as U,R as V,a as F,G as E,I as X,q as Y,r as z,e as B,o as Z,J,K,N as Q,A as $,P as j,U as ee,V as te}from"./index-f9af0687.js";import{C as se,a as ne}from"./CSS2DRenderer-b430b6f1.js";import{l as ie}from"./lodash-05a5e143.js";import{t as re}from"./tweakpane-efa3ef17.js";import{d as oe,h as ae,l as le,c as de,o as ce,a as he}from"./index-b3c877f3.js";import"./LoadingCreator-3ff16b20.js";import"./_plugin-vue_export-helper-c27b6911.js";const N=new k,me=new P,O=new k;class R extends I{constructor(s=document.createElement("div")){super(),this.element=s,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(s,t){return super.copy(s,t),this.element=s.element.cloneNode(!0),this}}R.prototype.isCSS3DObject=!0;class pe extends R{constructor(s){super(s),this.rotation2D=0}copy(s,t){return super.copy(s,t),this.rotation2D=s.rotation2D,this}}pe.prototype.isCSS3DSprite=!0;const w=new W,ue=new W;class ve{constructor(s={}){const t=this;let r,o,a,h;const c={camera:{fov:0,style:""},objects:new WeakMap},f=s.element!==void 0?s.element:document.createElement("div");f.style.overflow="hidden",this.domElement=f;const v=document.createElement("div");v.style.transformStyle="preserve-3d",v.style.pointerEvents="none",f.appendChild(v),this.getSize=function(){return{width:r,height:o}},this.render=function(i,e){const d=e.projectionMatrix.elements[5]*h;c.camera.fov!==d&&(f.style.perspective=e.isPerspectiveCamera?d+"px":"",c.camera.fov=d),i.autoUpdate===!0&&i.updateMatrixWorld(),e.parent===null&&e.updateMatrixWorld();let x,m;e.isOrthographicCamera&&(x=-(e.right+e.left)/2,m=(e.top+e.bottom)/2);const y=(e.isOrthographicCamera?"scale("+d+")translate("+n(x)+"px,"+n(m)+"px)"+C(e.matrixWorldInverse):"translateZ("+d+"px)"+C(e.matrixWorldInverse))+"translate("+a+"px,"+h+"px)";c.camera.style!==y&&(v.style.transform=y,c.camera.style=y),b(i,i,e)},this.setSize=function(i,e){r=i,o=e,a=r/2,h=o/2,f.style.width=i+"px",f.style.height=e+"px",v.style.width=i+"px",v.style.height=e+"px"};function n(i){return Math.abs(i)<1e-10?0:i}function C(i){const e=i.elements;return"matrix3d("+n(e[0])+","+n(-e[1])+","+n(e[2])+","+n(e[3])+","+n(e[4])+","+n(-e[5])+","+n(e[6])+","+n(e[7])+","+n(e[8])+","+n(-e[9])+","+n(e[10])+","+n(e[11])+","+n(e[12])+","+n(-e[13])+","+n(e[14])+","+n(e[15])+")"}function S(i){const e=i.elements;return"translate(-50%,-50%)"+("matrix3d("+n(e[0])+","+n(e[1])+","+n(e[2])+","+n(e[3])+","+n(-e[4])+","+n(-e[5])+","+n(-e[6])+","+n(-e[7])+","+n(e[8])+","+n(e[9])+","+n(e[10])+","+n(e[11])+","+n(e[12])+","+n(e[13])+","+n(e[14])+","+n(e[15])+")")}function b(i,e,d,x){if(i.isCSS3DObject){const m=i.visible===!0&&i.layers.test(d.layers)===!0;if(i.element.style.display=m===!0?"":"none",m===!0){i.onBeforeRender(t,e,d);let u;i.isCSS3DSprite?(w.copy(d.matrixWorldInverse),w.transpose(),i.rotation2D!==0&&w.multiply(ue.makeRotationZ(i.rotation2D)),i.matrixWorld.decompose(N,me,O),w.setPosition(N),w.scale(O),w.elements[3]=0,w.elements[7]=0,w.elements[11]=0,w.elements[15]=1,u=S(w)):u=S(i.matrixWorld);const y=i.element,g=c.objects.get(i);if(g===void 0||g.style!==u){y.style.transform=u;const M={style:u};c.objects.set(i,M)}y.parentNode!==v&&v.appendChild(y),i.onAfterRender(t,e,d)}}for(let m=0,u=i.children.length;m<u;m++)b(i.children[m],e,d)}}}let _;function ye(p,s){let t=p.parent;for(;t!==null;){if(s.includes(t.name))return!0;t=t.parent}return!1}let D=()=>{};class we{constructor(s){l(this,"basic");l(this,"scene");l(this,"camera");l(this,"renderer");l(this,"css2dRender");l(this,"css3dRender");l(this,"controls");l(this,"sizes");l(this,"useShader",!0);l(this,"clock");l(this,"helper");l(this,"debug");l(this,"resources");l(this,"emitter");l(this,"option");l(this,"material");this.option=s,this.emitter=new T.EventEmitter,this.basic=new H(s.dom),this.scene=this.basic.scene,this.renderer=this.basic.renderer,this.controls=this.basic.controls,this.camera=this.basic.camera,this.helper=new A(this.scene),this.sizes=new q(this),this.clock=new U,this.debug=new re.Pane({title:"🎉 mingo 🎉",expanded:!0}),this.initialize(),this.resources=new V({},()=>{console.log("资源加载完成",this.resources),this.createLight(),this.createRobotScen(),this.controls.update(),this.render()})}initialize(){this.scene.background=new F("#fff"),this.camera.position.set(0,150,300),this.emitter.on("resize",()=>{this.renderer.setSize(Number(this.sizes.viewport.width),Number(this.sizes.viewport.height)),this.camera.aspect=Number(this.sizes.viewport.width)/Number(this.sizes.viewport.height),this.camera.updateProjectionMatrix()})}createRobotScen(){let s=this.getRobot("Sprite");this.createTagBySprite("Sprite",s);let t=s.clone();t.name="CSS2D",t.position.setX(50),this.createTagByCss2D("CSS2D",t);let r=s.clone();r.name="CSS3D",r.position.setX(100),this.createTagByCss3D("CSS3D",r),this.scene.add(s),this.scene.add(t),this.scene.add(r),this.createMouseInput(s)}getRobot(s){var t=b(10,0,0,0);t.name="脑壳";var r=b(1,8,5,4);r.name="左眼";var o=b(1,8,5,-4);o.name="右眼";var a=new E;a.name="头部",r.material.color.set(16711680),o.material.color.set(16711680),a.add(t,r,o);var h=i(3,10,0,-15,0);h.name="脖子",h.material.color.set(16711680);var c=i(14,30,0,-35,0);c.name="腹部";var f=i(4,60,0,-80,-7);f.name="左腿";var v=i(4,60,0,-80,7);v.name="右腿";var n=new E;n.name="腿",n.add(f,v);var C=new E;C.name="身体",C.add(h,c,n);var S=new E;S.name=s,S.add(a,C),S.translateY(60),S.setRotationFromEuler(new X(0,-Math.PI/2,0));function b(e,d,x,m){var u=new Y(e,25,25),y=new z({color:255}),g=new B(u,y);return g.position.set(d,x,m),g}function i(e,d,x,m,u){var y=new Z(e,e,d,25,25),g=new z({color:16776960}),M=new B(y,g);return M.position.set(x,m,u),M}return S}createTagBySprite(s,t){let r=document.createElement("canvas"),o=r.getContext("2d");o.font="normal 50px Inter",o.fillStyle="rgba(0,0,0,1)",o.fillText(s,70,40);let a=new J(r);a.needsUpdate=!0;let h=new K({map:a}),c=new Q(h);c.position.set(t.position.x,t.position.y+10,t.position.z),c.scale.set(50,50,50),_=c,this.scene.add(c)}createTagByCss2D(s,t){var r=new se;r.setSize(window.innerWidth,window.innerHeight),r.domElement.style.position="absolute",r.domElement.style.top="0px",this.css2dRender=r,this.option.dom.appendChild(r.domElement);var o=document.createElement("div");o.className="label",o.textContent=s;var a=new ne(o);a.position.set(t.position.x,t.position.y+20,t.position.z),this.scene.add(a)}createTagByCss3D(s,t){var r=new ve;r.setSize(window.innerWidth,window.innerHeight),r.domElement.style.position="absolute",r.domElement.style.top="0px",this.css3dRender=r,this.option.dom.appendChild(r.domElement);var o=document.createElement("div");o.className="label3d",o.textContent=s;var a=new R(o);a.position.set(t.position.x,t.position.y+20,t.position.z),this.scene.add(a)}createLight(){const s=new $(4210752,1);this.scene.add(s);const t=new j(16777215,1,0);t.position.set(500,800,150),this.scene.add(t)}createMouseInput(s){const t=new ee,r=o=>{const a=new te;a.x=o.clientX/window.innerWidth*2-1,a.y=-(o.clientY/window.innerHeight)*2+1,t.setFromCamera(a,this.camera);const h=t.intersectObjects(this.scene.children);console.log(h),h.length>0&&ye(h[0].object,["Sprite"])?(_.visible=!1,s.children[0].children[0].scale.set(1.5,1.5,1.5)):(_.visible=!0,s.children[0].children[0].scale.set(1,1,1))};D=ie.debounce(r,20),window.addEventListener("mousemove",D,!1)}destory(){window.removeEventListener("mousemove",D),this.debug.dispose()}render(){requestAnimationFrame(this.render.bind(this)),this.renderer.render(this.scene,this.camera),this.css2dRender&&this.css2dRender.render(this.scene,this.camera),this.css3dRender&&this.css3dRender.render(this.scene,this.camera)}}const fe=he("div",{id:"threejs-canvas"},null,-1),Se=[fe],Re=oe({__name:"index",setup(p){let s;return ae(()=>{const t=document.querySelector("#threejs-canvas");s=new we({dom:t})}),le(()=>{s.destory()}),(t,r)=>(ce(),de("div",null,Se))}});export{Re as default};
