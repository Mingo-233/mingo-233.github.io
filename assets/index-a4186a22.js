var Ue=Object.defineProperty;var $e=(c,e,s)=>e in c?Ue(c,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[e]=s;var r=(c,e,s)=>($e(c,typeof e!="symbol"?e+"":e,s),s);import{d as Ve,h as Je,l as Ke,c as et,m as tt,o as it,a as st}from"./index-42613d43.js";import{U as He,O as ne,k as h,z as _,I as ae,y as B,f as ce,$ as ot,o as f,g as m,l as ge,F as ve,e as n,a0 as J,a1 as Q,q as nt,a2 as F,b as re,D as he,d as le,B as pe,H as de,S as ue,C as me,R as we,A as fe,P as be,M as D,a3 as Qe,Z as Xe,_ as at,a4 as Ye,G as rt,a as ht}from"./index-31c0b642.js";import{t as ye}from"./tweakpane-9ec2a9db.js";import{g as ct,r as Le,b as lt,c as Me,d as pt}from"./common-c22ab4d6.js";import"./LoadingCreator-28297c1b.js";import"./vendor-c27b6911.js";import"./lodash-1b411ee8.js";const L=new He,x=new h,X=new h,d=new _,Pe={X:new h(1,0,0),Y:new h(0,1,0),Z:new h(0,0,1)},se={type:"change"},Se={type:"mouseDown"},_e={type:"mouseUp",mode:null},Ee={type:"objectChange"};class Ce extends ne{constructor(e,s){super(),s===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),s=document),this.visible=!1,this.domElement=s,this.domElement.style.touchAction="none";const i=new Ze;this._gizmo=i,this.add(i);const o=new je;this._plane=o,this.add(o);const a=this;function t(b,E){let j=E;Object.defineProperty(a,b,{get:function(){return j!==void 0?j:E},set:function(Y){j!==Y&&(j=Y,o[b]=Y,i[b]=Y,a.dispatchEvent({type:b+"-changed",value:Y}),a.dispatchEvent(se))}}),a[b]=E,o[b]=E,i[b]=E}t("camera",e),t("object",void 0),t("enabled",!0),t("axis",null),t("mode","translate"),t("translationSnap",null),t("rotationSnap",null),t("scaleSnap",null),t("space","world"),t("size",1),t("dragging",!1),t("showX",!0),t("showY",!0),t("showZ",!0);const l=new h,u=new h,w=new _,M=new _,k=new h,z=new _,Z=new h,T=new h,g=new h,v=0,P=new h;t("worldPosition",l),t("worldPositionStart",u),t("worldQuaternion",w),t("worldQuaternionStart",M),t("cameraPosition",k),t("cameraQuaternion",z),t("pointStart",Z),t("pointEnd",T),t("rotationAxis",g),t("rotationAngle",v),t("eye",P),this._offset=new h,this._startNorm=new h,this._endNorm=new h,this._cameraScale=new h,this._parentPosition=new h,this._parentQuaternion=new _,this._parentQuaternionInv=new _,this._parentScale=new h,this._worldScaleStart=new h,this._worldQuaternionInv=new _,this._worldScale=new h,this._positionStart=new h,this._quaternionStart=new _,this._scaleStart=new h,this._getPointer=dt.bind(this),this._onPointerDown=mt.bind(this),this._onPointerHover=ut.bind(this),this._onPointerMove=wt.bind(this),this._onPointerUp=ft.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;L.setFromCamera(e,this.camera);const s=oe(this._gizmo.picker[this.mode],L);s?this.axis=s.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){L.setFromCamera(e,this.camera);const s=oe(this._plane,L,!0);s&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)),this.dragging=!0,Se.mode=this.mode,this.dispatchEvent(Se)}}pointerMove(e){const s=this.axis,i=this.mode,o=this.object;let a=this.space;if(i==="scale"?a="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(a="world"),o===void 0||s===null||this.dragging===!1||e.button!==-1)return;L.setFromCamera(e,this.camera);const t=oe(this._plane,L,!0);if(t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&s!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),s.indexOf("X")===-1&&(this._offset.x=0),s.indexOf("Y")===-1&&(this._offset.y=0),s.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&s!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),o.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(o.position.applyQuaternion(d.copy(this._quaternionStart).invert()),s.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.position.applyQuaternion(this._quaternionStart)),a==="world"&&(o.parent&&o.position.add(x.setFromMatrixPosition(o.parent.matrixWorld)),s.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.parent&&o.position.sub(x.setFromMatrixPosition(o.parent.matrixWorld))));else if(i==="scale"){if(s.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),X.set(l,l,l)}else x.copy(this.pointStart),X.copy(this.pointEnd),x.applyQuaternion(this._worldQuaternionInv),X.applyQuaternion(this._worldQuaternionInv),X.divide(x),s.search("X")===-1&&(X.x=1),s.search("Y")===-1&&(X.y=1),s.search("Z")===-1&&(X.z=1);o.scale.copy(this._scaleStart).multiply(X),this.scaleSnap&&(s.search("X")!==-1&&(o.scale.x=Math.round(o.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(o.scale.y=Math.round(o.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(o.scale.z=Math.round(o.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(x.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(x.copy(this.rotationAxis).cross(this.eye))*l):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(Pe[s]),x.copy(Pe[s]),a==="local"&&x.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(x.cross(this.eye).normalize())*l),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&s!=="E"&&s!=="XYZE"?(o.quaternion.copy(this._quaternionStart),o.quaternion.multiply(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),o.quaternion.copy(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),o.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(se),this.dispatchEvent(Ee)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(_e.mode=this.mode,this.dispatchEvent(_e)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(se),this.dispatchEvent(Ee),this.pointStart.copy(this.pointEnd))}getRaycaster(){return L}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}Ce.prototype.isTransformControls=!0;function dt(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function ut(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c));break}}function mt(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function wt(c){this.enabled&&this.pointerMove(this._getPointer(c))}function ft(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function oe(c,e,s){const i=e.intersectObject(c,!0);for(let o=0;o<i.length;o++)if(i[o].object.visible||s)return i[o];return!1}const K=new ae,p=new h(0,1,0),Ie=new h(0,0,0),ze=new B,ee=new _,ie=new _,A=new h,Ae=new B,W=new h(1,0,0),C=new h(0,1,0),G=new h(0,0,1),te=new h,R=new h,q=new h;class Ze extends ne{constructor(){super(),this.type="TransformControlsGizmo";const e=new ce({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=new ot({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const o=s.clone();o.opacity=.5;const a=e.clone();a.color.setHex(16711680);const t=e.clone();t.color.setHex(65280);const l=e.clone();l.color.setHex(255);const u=e.clone();u.color.setHex(16711680),u.opacity=.5;const w=e.clone();w.color.setHex(65280),w.opacity=.5;const M=e.clone();M.color.setHex(255),M.opacity=.5;const k=e.clone();k.opacity=.25;const z=e.clone();z.color.setHex(16776960),z.opacity=.25,e.clone().color.setHex(16776960);const T=e.clone();T.color.setHex(7895160);const g=new f(0,.04,.1,12);g.translate(0,.05,0);const v=new m(.08,.08,.08);v.translate(0,.04,0);const P=new ge;P.setAttribute("position",new ve([0,0,0,1,0,0],3));const b=new f(.0075,.0075,.5,3);b.translate(0,.25,0);function E(S,N){const I=new F(S,.0075,3,64,N*Math.PI*2);return I.rotateY(Math.PI/2),I.rotateX(Math.PI/2),I}function j(){const S=new ge;return S.setAttribute("position",new ve([0,0,0,1,1,1],3)),S}const Y={X:[[new n(g,a),[.5,0,0],[0,0,-Math.PI/2]],[new n(g,a),[-.5,0,0],[0,0,Math.PI/2]],[new n(b,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new n(g,t),[0,.5,0]],[new n(g,t),[0,-.5,0],[Math.PI,0,0]],[new n(b,t)]],Z:[[new n(g,l),[0,0,.5],[Math.PI/2,0,0]],[new n(g,l),[0,0,-.5],[-Math.PI/2,0,0]],[new n(b,l),null,[Math.PI/2,0,0]]],XYZ:[[new n(new J(.1,0),k.clone()),[0,0,0]]],XY:[[new n(new m(.15,.15,.01),M.clone()),[.15,.15,0]]],YZ:[[new n(new m(.15,.15,.01),u.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new m(.15,.15,.01),w.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Oe={X:[[new n(new f(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new n(new f(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n(new f(.2,0,.6,4),i),[0,.3,0]],[new n(new f(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n(new f(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new n(new f(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new n(new J(.2,0),i)]],XY:[[new n(new m(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new n(new m(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new m(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},Be={START:[[new n(new J(.01,2),o),null,null,null,"helper"]],END:[[new n(new J(.01,2),o),null,null,null,"helper"]],DELTA:[[new Q(j(),o),null,null,null,"helper"]],X:[[new Q(P,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Q(P,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Q(P,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},De={XYZE:[[new n(E(.5,1),T),null,[0,Math.PI/2,0]]],X:[[new n(E(.5,.5),a)]],Y:[[new n(E(.5,.5),t),null,[0,0,-Math.PI/2]]],Z:[[new n(E(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new n(E(.75,1),z),null,[0,Math.PI/2,0]]]},Fe={AXIS:[[new Q(P,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Re={XYZE:[[new n(new nt(.25,10,8),i)]],X:[[new n(new F(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n(new F(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n(new F(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n(new F(.75,.1,2,24),i)]]},qe={X:[[new n(v,a),[.5,0,0],[0,0,-Math.PI/2]],[new n(b,a),[0,0,0],[0,0,-Math.PI/2]],[new n(v,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new n(v,t),[0,.5,0]],[new n(b,t)],[new n(v,t),[0,-.5,0],[0,0,Math.PI]]],Z:[[new n(v,l),[0,0,.5],[Math.PI/2,0,0]],[new n(b,l),[0,0,0],[Math.PI/2,0,0]],[new n(v,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new n(new m(.15,.15,.01),M),[.15,.15,0]]],YZ:[[new n(new m(.15,.15,.01),u),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new m(.15,.15,.01),w),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n(new m(.1,.1,.1),k.clone())]]},We={X:[[new n(new f(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new n(new f(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n(new f(.2,0,.6,4),i),[0,.3,0]],[new n(new f(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n(new f(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new n(new f(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new n(new m(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new n(new m(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new m(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n(new m(.2,.2,.2),i),[0,0,0]]]},Ge={X:[[new Q(P,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Q(P,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Q(P,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function H(S){const N=new ne;for(const I in S)for(let O=S[I].length;O--;){const y=S[I][O][0].clone(),U=S[I][O][1],$=S[I][O][2],V=S[I][O][3],Ne=S[I][O][4];y.name=I,y.tag=Ne,U&&y.position.set(U[0],U[1],U[2]),$&&y.rotation.set($[0],$[1],$[2]),V&&y.scale.set(V[0],V[1],V[2]),y.updateMatrix();const xe=y.geometry.clone();xe.applyMatrix4(y.matrix),y.geometry=xe,y.renderOrder=1/0,y.position.set(0,0,0),y.rotation.set(0,0,0),y.scale.set(1,1,1),N.add(y)}return N}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(Y)),this.add(this.gizmo.rotate=H(De)),this.add(this.gizmo.scale=H(qe)),this.add(this.picker.translate=H(Oe)),this.add(this.picker.rotate=H(Re)),this.add(this.picker.scale=H(We)),this.add(this.helper.translate=H(Be)),this.add(this.helper.rotate=H(Fe)),this.add(this.helper.scale=H(Ge)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ie;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let o=[];o=o.concat(this.picker[this.mode].children),o=o.concat(this.gizmo[this.mode].children),o=o.concat(this.helper[this.mode].children);for(let a=0;a<o.length;a++){const t=o[a];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(l*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.position.copy(this.worldPositionStart),t.visible=!!this.axis,this.axis==="X"&&(d.setFromEuler(K.set(0,0,0)),t.quaternion.copy(i).multiply(d),Math.abs(p.copy(W).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(d.setFromEuler(K.set(0,0,Math.PI/2)),t.quaternion.copy(i).multiply(d),Math.abs(p.copy(C).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(d.setFromEuler(K.set(0,Math.PI/2,0)),t.quaternion.copy(i).multiply(d),Math.abs(p.copy(G).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(d.setFromEuler(K.set(0,Math.PI/2,0)),p.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(ze.lookAt(Ie,p,C)),t.quaternion.multiply(d),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),x.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),x.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(x),t.visible=this.dragging):(t.quaternion.copy(i),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(t.name==="X"&&Math.abs(p.copy(W).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(p.copy(C).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(p.copy(G).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(p.copy(G).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(p.copy(W).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(p.copy(C).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)):this.mode==="rotate"&&(ee.copy(i),p.copy(this.eye).applyQuaternion(d.copy(i).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(ze.lookAt(this.eye,Ie,C)),t.name==="X"&&(d.setFromAxisAngle(W,Math.atan2(-p.y,p.z)),d.multiplyQuaternions(ee,d),t.quaternion.copy(d)),t.name==="Y"&&(d.setFromAxisAngle(C,Math.atan2(p.x,p.z)),d.multiplyQuaternions(ee,d),t.quaternion.copy(d)),t.name==="Z"&&(d.setFromAxisAngle(G,Math.atan2(p.y,p.x)),d.multiplyQuaternions(ee,d),t.quaternion.copy(d))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis||this.axis.split("").some(function(u){return t.name===u}))&&(t.material.color.setHex(16776960),t.material.opacity=1)}super.updateMatrixWorld(e)}}Ze.prototype.isTransformControlsGizmo=!0;class je extends n{constructor(){super(new re(1e5,1e5,2,2),new ce({visible:!1,wireframe:!0,side:he,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane"}updateMatrixWorld(e){let s=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(s="local"),te.copy(W).applyQuaternion(s==="local"?this.worldQuaternion:ie),R.copy(C).applyQuaternion(s==="local"?this.worldQuaternion:ie),q.copy(G).applyQuaternion(s==="local"?this.worldQuaternion:ie),p.copy(R),this.mode){case"translate":case"scale":switch(this.axis){case"X":p.copy(this.eye).cross(te),A.copy(te).cross(p);break;case"Y":p.copy(this.eye).cross(R),A.copy(R).cross(p);break;case"Z":p.copy(this.eye).cross(q),A.copy(q).cross(p);break;case"XY":A.copy(q);break;case"YZ":A.copy(te);break;case"XZ":p.copy(q),A.copy(R);break;case"XYZ":case"E":A.set(0,0,0);break}break;case"rotate":default:A.set(0,0,0)}A.length()===0?this.quaternion.copy(this.cameraQuaternion):(Ae.lookAt(x.set(0,0,0),A,p),this.quaternion.setFromRotationMatrix(Ae)),super.updateMatrixWorld(e)}}je.prototype.isTransformControlsPlane=!0;const{createMouseInput:bt,desotryMouseInput:yt}=Le("click");let xt=class{constructor(e){r(this,"basic");r(this,"scene");r(this,"camera");r(this,"renderer");r(this,"controls");r(this,"sizes");r(this,"useShader",!0);r(this,"clock");r(this,"helper");r(this,"debug");r(this,"resources");r(this,"emitter");r(this,"option");r(this,"material");r(this,"box");r(this,"boxHelper");this.option=e,this.emitter=new le.EventEmitter,this.basic=new pe(e.dom),this.scene=this.basic.scene,this.renderer=this.basic.renderer,this.controls=this.basic.controls,this.camera=this.basic.camera,this.helper=new de(this.scene),this.sizes=new ue(this),this.clock=new me,this.debug=new ye.Pane({title:"🎉 mingo 🎉",expanded:!0}),this.resources=new we({},()=>{this.initialize(),this.createLight(),console.log("资源加载完成",this.resources),this.createBox(),this.createTransformControls(),this.createSelectBox(),bt(this.camera,this.scene,s=>{let i=!1,o=1;for(let a=0;a<o;a++){if(s[a].object.name==="coreBox"){this.switchSelectBox(this.box,!1),i=!0;break}i||this.switchSelectBox(this.box,!0)}}),this.controls.update(),this.render()})}initialize(){this.camera.position.set(30,10,30),this.emitter.on("resize",()=>{this.renderer.setSize(Number(this.sizes.viewport.width),Number(this.sizes.viewport.height)),this.camera.aspect=Number(this.sizes.viewport.width)/Number(this.sizes.viewport.height),this.camera.updateProjectionMatrix()}),this.debug.addButton({title:"target点切换",label:"target"}).on("click",e=>{this.basic.setControlsTarget(new h(10,0,0))}),this.debug.addButton({title:"f键",label:"聚焦"}).on("click",e=>{this.focus(this.box)}),this.debug.addButton({title:"click ",label:"选中"}).on("click",e=>{setTimeout(()=>{this.switchSelectBox(this.box,!1)},100)}),this.eventListener(this)}createLight(){const e=new fe(4210752,1);this.scene.add(e);const s=new be(16777215,2,0);s.position.set(20,40,15),this.scene.add(s),this.helper.addGridHelper(),this.helper.addLight(s,"point"),this.helper.addAxes()}createBox(){const e=new m(10,10,10),s=new D({color:3359830}),i=new n(e,s);i.name="coreBox",this.box=i,this.scene.add(i),i.position.set(0,0,0)}createTransformControls(){let e=new Ce(this.camera,this.renderer.domElement);e.attach(this.box);let s=this;this.scene.add(e),e.addEventListener("change",this.render.bind(this)),e.addEventListener("dragging-changed",function(i){s.basic.controls.enabled=!i.value})}createSelectBox(){const e=new Qe(this.box,16776960);e.visible=!1,this.boxHelper=e,this.scene.add(this.boxHelper)}switchSelectBox(e,s){if(s){this.boxHelper.visible=!1;return}this.boxHelper.setFromObject(e),this.boxHelper.visible=!0}destory(){document.removeEventListener("keydown",e=>ke(e,this)),yt(),this.debug.dispose()}render(){requestAnimationFrame(this.render.bind(this)),this.renderer.render(this.scene,this.camera)}focus2(){const e=new h;this.box.getWorldPosition(e);const i=this.basic.camera.position.clone().clone().sub(e);i.normalize(),i.x=Math.round(i.x*10)/10,i.y=Math.round(i.y*10)/10,i.z=Math.round(i.z*10)/10;const o=this.box.geometry.boundingSphere.radius*6,a=e.clone().add(i.clone().multiplyScalar(o));this.basic.camera.position.copy(a),this.basic.camera.lookAt(e),this.basic.setControlsTarget(e)}focus(e,s=.3,i=2){e=this.box;const o=this.basic.camera;let a=new Xe,t=new h;if(a.setFromObject(e),a.getCenter(t),o instanceof at){let l=new h,u=new h,w=new h;a.getCenter(l);const M=a.getSize(new h),k=Math.max(M.x,M.y,M.z)/2,z=a.getSize(new h).y,Z=a.getSize(new h).x,T=Ye.degToRad(o.fov/2),g=z/(2*Math.tan(T)),v=Z/(2*Math.tan(T)*o.aspect),P=Math.max(g,v)+k*i;u.set(0,0,1),u.applyQuaternion(o.quaternion),u.multiplyScalar(P*1),w.copy(l).add(u),console.log(w),this.updateCameraTargetAndPosition(l,w,2)}}updateCameraTargetAndPosition(e,s,i=.3){ct.to(this.basic.camera.position,{x:s.x,y:s.y,z:s.z,duration:i,ease:"easeInOut",onStart:()=>{},onComplete:()=>{this.basic.camera.lookAt(e),console.log("执行完成")}})}eventListener(e){document.addEventListener("keydown",s=>ke(s,e))}};function ke(c,e){c.key==="f"&&e.focus()}const{createMouseInput:Yt,desotryMouseInput:gt}=Le("click");let vt=class{constructor(e){r(this,"basic");r(this,"scene");r(this,"camera");r(this,"renderer");r(this,"controls");r(this,"sizes");r(this,"useShader",!0);r(this,"clock");r(this,"helper");r(this,"debug");r(this,"resources");r(this,"emitter");r(this,"option");r(this,"material");r(this,"box");r(this,"boxHelper");this.option=e,this.emitter=new le.EventEmitter,this.basic=new pe(e.dom),this.scene=this.basic.scene,this.renderer=this.basic.renderer,this.controls=this.basic.controls,this.camera=this.basic.camera,this.helper=new de(this.scene),this.sizes=new ue(this),this.clock=new me,this.debug=new ye.Pane({title:"🎉 mingo 🎉",expanded:!0}),this.resources=new we({textures:[{name:"CocaCola",path:"./lib/other/CocaCola.jpeg"}]},()=>{this.initialize(),this.createLight(),console.log("资源加载完成",this.resources),this.createBoxGroup(),this.createSelectBox(),this.controls.update(),this.render()})}initialize(){this.camera.position.set(100,30,100),this.emitter.on("resize",()=>{this.renderer.setSize(Number(this.sizes.viewport.width),Number(this.sizes.viewport.height)),this.camera.aspect=Number(this.sizes.viewport.width)/Number(this.sizes.viewport.height),this.camera.updateProjectionMatrix()}),this.debug.addButton({title:"click ",label:"旋转 down"}).on("click",e=>{this.setChildrenRotate(this.box,"down")}),this.debug.addButton({title:"click ",label:"旋转 right"}).on("click",e=>{this.setChildrenRotate(this.box,"right")}),this.eventListener(this)}setChildrenRotate(e,s,i=90){if(!e)return;Ye.degToRad(i);let o=e.clone();const a=new Xe().setFromObject(o),t=new h;a.getCenter(t),console.log("center",t),s==="right"?new ae(0,0,Math.PI/2,"XYZ"):new ae(Math.PI/2,0,0,"XYZ");const l=s==="right"?new _().setFromAxisAngle(new h(0,0,1),Math.PI/2):new _().setFromAxisAngle(new h(1,0,0),Math.PI/2),u=new B().makeTranslation(-t.x,-t.y,-t.z),w=new B().makeRotationFromQuaternion(l),M=new B().makeTranslation(t.x,t.y,t.z),k=new B().multiplyMatrices(M,w).multiply(u);o.applyMatrix4(k),e==null||e.children.forEach((z,Z)=>{let T=o.children[Z].getWorldPosition(new h),g=e.position,v=T.sub(g);z.applyMatrix4(w),z.position.copy(v)})}createLight(){const e=new fe(4210752,1);this.scene.add(e);const s=new be(16777215,2,0);s.position.set(20,40,15),this.scene.add(s),this.helper.addGridHelper(),this.helper.addLight(s,"point"),this.helper.addAxes()}createBox(){const e=new m(10,10,10),s=new D({color:3359830}),i=new n(e,s);i.name="coreBox",this.box=i,this.scene.add(i),i.position.set(0,0,0)}createBoxGroup(){const e=new f(5,5,5,32),s=new D({color:3359830}),i=new f(5,5,10,32),o=new D({color:16777215,map:this.resources.textures.CocaCola}),a=new n(e,s);a.name="no1";const t=new n(i,o);t.name="no2",a.position.set(10,10,0),t.position.set(10,0,0);const l=new rt;l.position.set(0,20,0),l.add(a),l.add(t),this.box=l,this.scene.add(l)}createSelectBox(){const e=new Qe(this.box,16776960);e.visible=!0,this.boxHelper=e,this.scene.add(this.boxHelper)}switchSelectBox(e,s){if(s){this.boxHelper.visible=!1;return}this.boxHelper.setFromObject(e),this.boxHelper.visible=!0}destory(){document.removeEventListener("keydown",e=>Te(e,this)),gt(),this.debug.dispose()}render(){requestAnimationFrame(this.render.bind(this)),this.renderer.render(this.scene,this.camera)}eventListener(e){document.addEventListener("keydown",s=>Te(s,e))}};function Te(c,e){c.key==="f"&&e.focus()}class Mt{constructor(e){r(this,"basic");r(this,"scene");r(this,"camera");r(this,"renderer");r(this,"controls");r(this,"sizes");r(this,"useShader",!0);r(this,"clock");r(this,"helper");r(this,"debug");r(this,"resources");r(this,"emitter");r(this,"option");r(this,"material");r(this,"box");r(this,"boxHelper");r(this,"rollOverMesh");r(this,"floorCube");r(this,"createRollOverMesh",(e=5,s=5)=>{if(this.rollOverMesh)this.rollOverMesh.scale.x=e,this.rollOverMesh.scale.y=s;else{const i=new re(1,1),o=new ce({color:16736525,fog:!1,transparent:!0,opacity:.3,depthTest:!1,depthWrite:!1,side:he});let a=new n(i,o);a.scale.x=e,a.scale.y=s,a.name="rollOverMesh",a.renderOrder=1/0,a.rotateX(Math.PI/2),a.position.set(0,0,0),this.rollOverMesh=a,this.scene.add(this.rollOverMesh)}});this.option=e,this.emitter=new le.EventEmitter,this.basic=new pe(e.dom),this.scene=this.basic.scene,this.renderer=this.basic.renderer,this.controls=this.basic.controls,this.camera=this.basic.camera,this.helper=new de(this.scene),this.sizes=new ue(this),this.clock=new me,this.debug=new ye.Pane({title:"🎉 mingo 🎉",expanded:!0}),this.resources=new we({},()=>{this.initialize(),this.createLight(),this.createBox(),this.creatFloor(),setTimeout(()=>{this.showToTheClosestSurfaceHelperMesh(this.box)},500),this.controls.update(),this.render()})}initialize(){this.scene.background=new ht("#eee"),this.basic.renderer.shadowMap.enabled=!0,this.camera.position.set(100,30,100),this.emitter.on("resize",()=>{this.renderer.setSize(Number(this.sizes.viewport.width),Number(this.sizes.viewport.height)),this.camera.aspect=Number(this.sizes.viewport.width)/Number(this.sizes.viewport.height),this.camera.updateProjectionMatrix()}),this.debug.addButton({title:"click ",label:"落下"}).on("click",e=>{this.fallDown()})}createLight(){const e=new fe(4210752,1);this.scene.add(e);const s=new be(16777215,2,0);s.castShadow=!0,s.position.set(20,40,15),this.scene.add(s),this.helper.addLight(s,"point"),this.helper.addAxes()}createBox(){const e=new m(10,10,10),s=new D({color:3359830}),i=new n(e,s);i.name="coreBox",i.castShadow=!0,i.position.set(0,20,0),this.box=i,this.scene.add(i)}creatFloor(){const e=new re(100,100),s=new D({color:3359830,side:he}),i=new n(e,s);i.name="floorCube",i.position.set(0,0,0),i.rotateX(-Math.PI/2),i.receiveShadow=!0,this.floorCube=i,this.scene.add(i)}async showToTheClosestSurfaceHelperMesh(e,s=!0){try{if(!e)throw new Error("未选中模型");const i=lt(this.scene),{point:o,object:a}=Pt(e,i,1),t=Me(e);return this.createRollOverMesh(t.width,t.depth),Promise.resolve()}catch(i){return Promise.reject(i)}}fallDown(){const{x:e,y:s,z:i}=this.rollOverMesh.position,o=Me(this.box);this.box.position.set(e,o.height/2,i),this.rollOverMesh.visible=!1}destory(){this.debug.dispose()}render(){requestAnimationFrame(this.render.bind(this)),this.renderer.render(this.scene,this.camera)}}const Pt=(c,e,s)=>{let i=pt(c);const o=new He(new h(c.position.x,i.minY,c.position.z),new h(0,-1,0)),a=e.filter(w=>w.uuid!==c.uuid);let t=o.intersectObjects(a);if(!t)throw new Error("下方没有相交的面");const{point:l,object:u}=t[0];return{point:l,object:u}},St=st("div",{id:"threejs-canvas"},null,-1),_t=[St],Ct=Ve({__name:"index",setup(c){let e;const s=tt();return Je(()=>{const i=document.querySelector("#threejs-canvas");let{scene:o}=s.query;switch(o){case"editor2":e=new vt({dom:i});break;case"editor3":e=new Mt({dom:i});break;default:e=new xt({dom:i});break}}),Ke(()=>{e.destory()}),(i,o)=>(it(),et("div",null,_t))}});export{Ct as default};
