var A=Object.defineProperty;var R=(o,e,t)=>e in o?A(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>(R(o,typeof e!="symbol"?e+"":e,t),t);import{d as C,H as P,S as T,C as b,R as M,G as v,a as k,W as G,A as L,p as D,b as B,X as z,D as I,c as f,e as w,q as N,Y as O,f as Y,h as y,i as S,V as X,Z as x,k as g,B as j,_ as F}from"./index-606c6e35.js";import{t as H}from"./tweakpane-6ffcf4ab.js";import{d as U,h as V,l as W,c as q,o as J,a as K}from"./index-2256cc31.js";import"./LoadingCreator-e47e8c93.js";import"./_plugin-vue_export-helper-c27b6911.js";const Z=20,Q=20,$=-20,ee=1,te=.5,se=3,ie=4,ae=-5,oe=10,re=2,ne=-50,ce=-10,he=.02,le=10;let _=0,E=0,p=0,h=0,u=!1,d=!0,n,l=1;function de(o,e){return Math.floor(Math.random()*(e-o))+o}function m(o,e){return Math.random()*(e-o)+o}function pe(){n=document.createElement("div"),n.id="info",n.innerHTML="Press any key to start!",document.body.appendChild(n)}function ue(){d=!0,n.innerHTML="GAME OVER"}class me extends j{constructor(e,t){super(e,t),this.initCamera(),this.initRender()}initCamera(){this.camera=new F(45,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(3,1,10),this.camera.lookAt(3,3,0)}}class fe{constructor(e){i(this,"basic");i(this,"scene");i(this,"camera");i(this,"renderer");i(this,"controls");i(this,"sizes");i(this,"useShader",!0);i(this,"clock");i(this,"helper");i(this,"debug");i(this,"resources");i(this,"emitter");i(this,"option");i(this,"material");i(this,"mixers",[]);i(this,"cactus");i(this,"trex");i(this,"floor");i(this,"pterodactyl");i(this,"skySphere");i(this,"cactusGroup",[]);this.option=e,this.emitter=new C.EventEmitter,this.basic=new me(e.dom,!1),this.scene=this.basic.scene,this.renderer=this.basic.renderer,this.controls=this.basic.controls,this.camera=this.basic.camera,this.helper=new P(this.scene),console.log(this.camera),this.sizes=new T(this),this.clock=new b,this.debug=new H.Pane({title:"🎉 mingo 🎉",expanded:!0}),this.initialize();const t={textures:[{name:"sand",path:"/lib/tRex/sand.jpg"},{name:"desert",path:"/lib/tRex/desert.jpg"}],models:[{name:"cactus",path:"/lib/tRex/models/cactus/scene.gltf"},{name:"tRex",path:"/lib/tRex/models/t-rex/scene.gltf"},{name:"pterodactyl",path:"/lib/tRex/models/pterodactyl/scene.gltf"}]};this.resources=new M(t,()=>{console.log("资源加载完成",this.resources),this.cactusGroup=new v,this.createFloor(),this.createSkySphere(),this.createLight(),this.createTRex(),this.createPterodactyl(),this.createCactus(),this.render(),pe(),this.handleInput();const s={cactusSize:l};this.debug.addInput(s,"cactusSize",{min:.1,max:1,step:.01}).on("change",a=>{l=a.value,console.log(l)})})}initialize(){this.scene.background=new k("#000"),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=G,this.emitter.on("resize",()=>{this.renderer.setSize(Number(this.sizes.viewport.width),Number(this.sizes.viewport.height)),this.camera.aspect=Number(this.sizes.viewport.width)/Number(this.sizes.viewport.height),this.camera.updateProjectionMatrix()})}handleInput(){const e=()=>{if(d){this.initGameData();return}u=!0};document.addEventListener("keydown",e,!1),this.renderer.domElement.addEventListener("touchstart",e)}initGameData(){d=!1,p=0,this.cactusGroup.children=[]}createLight(){const e=new L(8355711,1);this.scene.add(e);const t=new D(16777215,2);t.position.set(0,10,0),t.castShadow=!0,t.shadow.mapSize.width=512,t.shadow.mapSize.height=512,t.shadow.camera.near=.001,t.shadow.camera.far=500,this.scene.add(t)}createFloor(){const e=new B(1e3,1e3,10,10),t=new z({color:12874555,map:null,side:I}),s=this.resources.textures.sand;console.log(s),s.wrapS=f,s.wrapT=f,s.repeat.set(10,10),t.map=s,t.needsUpdate=!0;const a=new w(e,t);a.rotateX(-Math.PI/2),a.castShadow=!1,a.receiveShadow=!0,this.scene.add(a),this.floor=a}createSkySphere(){const e=new N(500,60,40);e.scale(-1,1,1);const t=this.resources.textures.desert;t.encoding=O;const s=new Y({map:t}),a=new w(e,s);this.skySphere=a,this.scene.add(a)}createTRex(){const e=this.resources.models.tRex,t=e.scene;t.scale.setScalar(.5),t.rotation.y=Math.PI/2,t.traverse(r=>{r.castShadow=!0,r.receiveShadow=!1}),this.trex=t,this.scene.add(t);const s=new y(t),a=S.findByName(e.animations,"run");a&&s.clipAction(a).play(),this.mixers.push(s)}createPterodactyl(){const e=this.resources.models.pterodactyl,t=e.scene;t.rotation.y=Math.PI/2,t.scale.multiplyScalar(4),this.pterodactyl=t,this.scene.add(t),this.respawnPterodactyl();const s=new y(t),a=S.findByName(e.animations,"flying");a&&s.clipAction(a).play(),this.mixers.push(s)}createCactus(){const t=this.resources.models.cactus.scene;t.scale.setScalar(.05),t.rotation.y=Math.PI/2,this.cactus=t,this.cactusGroup.add(t),this.scene.add(this.cactusGroup),console.log(this.cactusGroup)}playing(e){if(!this.cactus||!this.trex||!this.floor||!this.pterodactyl||d)return;if(this.mixers.length>0)for(const s of this.mixers)s.update(e);if(u&&(u=!1,this.trex.position.y==0&&(h=Z,this.trex.position.y=h*e)),this.trex.position.y>0?(h+=ne*e,this.trex.position.y+=h*e):this.trex.position.y=0,this.clock.elapsedTime>E){const s=m(2,4);E=this.clock.elapsedTime+s;const a=de(3,5);for(let r=0;r<a;r++){const c=this.cactus.clone();c.scale.setScalar(.05*l),c.position.x=Q+r*.5,c.scale.multiplyScalar(m(te,ee)),this.cactusGroup.add(c)}}for(;this.cactusGroup.children.length>0&&this.cactusGroup.children[0].position.x<$;)this.cactusGroup.remove(this.cactusGroup.children[0]);for(const s of this.cactusGroup.children)s.position.x+=ce*e;this.clock.elapsedTime>_?this.respawnPterodactyl():this.pterodactyl.position.x+=e*re,this.floor.material.map.offset.add(new X(e*.1,0)),this.skySphere&&(this.skySphere.rotation.y+=e*he);const t=new x(new g(-1,this.trex.position.y,0),new g(1,this.trex.position.y+2,0));for(const s of this.cactusGroup.children){const a=new x;if(a.setFromObject(s),a.intersectsBox(t)){ue();return}}p+=e*le,n.innerHTML=Math.floor(p).toString().padStart(5,"0")}respawnPterodactyl(){_=this.clock.elapsedTime+oe,this.pterodactyl.position.x=ae,this.pterodactyl.position.y=m(se,ie)}render(){const e=this.clock.getDelta();requestAnimationFrame(this.render.bind(this)),this.playing(e),this.renderer.render(this.scene,this.camera)}destory(){document.body.removeChild(n),this.debug.dispose()}}const we=K("div",{id:"threejs-canvas"},null,-1),ye=[we],Re=U({__name:"index",setup(o){let e;return V(()=>{const t=document.querySelector("#threejs-canvas");e=new fe({dom:t})}),W(()=>{e.destory()}),(t,s)=>(J(),q("div",null,ye))}});export{Re as default};
